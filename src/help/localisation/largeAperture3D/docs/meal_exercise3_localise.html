<html>
<head>
<LINK href="../../../pamHelpStylesheet.css" type="text/css"
	rel="STYLESHEET">
<title>Localise</title>
</head>

<body>

<h1>Large Aperture 3D Localiser</h1>
<h2>Localise</h2>

<h3>
Summary
<NAME="Summary">
</h3>


<p><i>Add the
MEAL localiser and localise porpoise clicks. Batch process the entire dataset
and view in a spread sheet. Create a graph of the dive profile. </i></p>

<h3>
3.1 Set up the localiser
<NAME="Setupthelocaliser">
</h3>

<p>Now we have
detected and classified our porpoise clicks we can begin to localise. The MEAL localiser module is currently still under
development and can only be accessed in PAMGuard viewer. This partly due
to the fact that localisation is computationally intensive and so currently not
suitable for real time use. </p>

<p>For this
exercise we are going to use some data already prepared so that all
participants are using the same classification settings etc. Start a new
instance of PAMGuard viewer mode, open the database named <b><i>PorpFineScalePAMTech
</i></b>in the Exercise 3 folder and select the corresponding binary files in
the folder named <b><i>20120630. </i></b></p>

<p>Go to <b><i>File > Add
Modules > Loclaisers > MEAL localiser. </i></b>This will add the MEAL
localiser to viewer mode. As the module is
still in development there are a few minor issues which need to be sorted out
when adding the module. Your instructor will guide you through these.</p>

<p>You should
end up with a new localiser tab which looks like. </p>

<center>
<p><img width=601 height=376 id="Picture 24" src="images/image026.jpg"></p>

<p>Figure 14. The MEAL localiser should initially look
something like this. </p>
</center>

<p>For the rest
of this exercise we will divide the localiser into panels and refer to each
panel by the names given below.</p>

<center>
<p><img width=602 height=384 id="Content Placeholder 4" src="images/image027.jpg"></p>

<table>
<tr>
<td>
	1) Data block selection menu
<br>2) Click bt display
<br>3) Algorithm selection
<br>4) Detection match</td>
<td>
	5) Localiser controls
<br>6) Map
<br>7) Algorithm display
<br>8) Results</td>
</tr>
</table>

</center>

<p>The top <b>Click bt display</b> panel contains a miniature bearing time display however since we
did not group any of our clicks there is no bearing information to display.
Right click on the display, select <b><i>Bearing Amplitude Options</i></b> and
in the dialog box select <b><i>Amplitude</i></b>. </p>
<center>
<p><img width=261 height=246 id="Picture 27"
src="images/image028.png"></p>

<p>Figure 15. Because we did not group clicks we will need to
view them on an amplitude time rather than bearing time display.</p>
</center>
<p>The <b>Click bt display</b> panel should now look similar to your main Click Detector
bearing time display. Select Porpoise in the <b><i>Filter Species</i></b> box.
This tells the localiser to only use classified porpoise clicks in
calculations.</p>

<p>The <b>Map</b>
panel displays localisation results and shows the hydrophone array. Right click
to drag the map, left click to rotate and use the mouse wheel to zoom in and
out. Your display should now look something like. </p>
<center>
<p><img width=539 height=337
id="Picture 30" src="images/image029.jpg"></p>

<p>Figure 16. Use the mouse left click, right click and wheel to manipulate the 3D map. </p>
</center>
<p>Select a
porpoise click. You should notice the <b>Detection match</b> panel changing.
The <b>Detection match</b> panel contains information on the number of possible
time delay combinations. The red circle represents the selected detection, in
this case whichever click you have selected in the <b>Click bt Display.</b> This
selected detection is your <b><u>primary detection. </u></b>We need to find
this detection on other hydrophones; to do this we look in a time window before
and after the time of the primary detection, represented in the panle by a grey
line. Each hydrophone will have a different time window depending on how far it
is away from the primary hydrophone. It is possible that a time window will
contain more than one detection and for species such as a harbour porpoise,
which has indistinguishable clicks, there is a an equal likelihood that any one
click within the time window could be the primary click we are looking for.
The <b>blue dots</b> represent the possible matches to the primary click within
the time windows. Each <b>blue line</b> represents a possible combination of
detections of which only one will contain only detections which correspond to
the primary detection. The number of possibilities is shown at the top of the
window.</p>
<center>
<p>
<table>
<tr>
<td>
<img width=395 height=236
id="Picture 288" src="images/image031.png"></td>
<td>
Reasons for multiple time delay possibilities
<br>-echoes
<br>-multiple animals
<br>-rapid vocalisations
<br>-widely spaced elements</td>
</tr>
</table>
</p>

<p>Figure 17. The number of possible time delay combinations
is displayed in the <b>Detection match</b> panel. Lines represent each
combination and the red dot represents the currently selected detection. </p>
</center>

<p>For this
exercise we are only going to use the vertical component of the array to
determine depth and range. This will reduce the number of time delay
possibilities and give us information on depth and range. In the <b>localiser
controls</b> panel select <b><i>Options </i>and </b>in the<b> <i>Channels </i></b>tab
deselect channels 6, 7, 8 and 9. In the <b><i>Map</i></b> tab make sure that <b><i>Use
high res. Plot symbols</i></b> is selected. Click <b><i>OK</i></b>.</p>
<center>
<p><img width=171 height=331 id="Picture 291"
src="images/image032.jpg"></p>

<p>Figure 18. For this exercise we only need channels 0-5
selected.</p>
</center>

<h3>
3.2 Localise a click
<NAME="Localiseaclick">
</h3>
<p>We are now
going to perform our first localisation. Select MCMC in the <b>Algorithm
selection</b> panel. You should see the <b><i>Localise</i></b>, <b><i>Localise
All</i></b>, and <b><i>Stop </i></b>buttons becoming enabled. Find a click
which contains corresponding detections on most other channels and has more
than one time delay possibility. In the detection match panel such a click
should look something like...</p>
<center>
<p><img width=312 height=189 id="Picture 290" src="images/image033.jpg"></p>

<p>Figure 19. Select a click which has time delay
possibilities roughly similar to this.</p>
</center>
<p>First we are
going to localise only one combination. Click the <b>Localise</b> Button.</p>

<center>
<p><img width=602 height=387 id="Picture 299"
src="images/image034.jpg"></p>

<p>Figure 20. MCMC produces a circular probability
distribution. This is exactly what would be expected from a linear array. </p>
</center>

<p>You should
notice a circular 'cloud' appear on the map. This cloud corresponds to the
probability distribution of the porpoises' location calculated by the MCMC
algorithm. The cloud is circular because a linear array only allows us to
determine <b>depth</b> and <b>range.</b></p>

<center>
<p><img width=601 height=376 id="Picture 298"
src="images/image035.jpg"></p>

<p>Figure 21. Using the map you can view the circle side on.
Note it has a well-defined depth. </p>
</center>

<p>Align the
map horizontally and you will see the circle has well defined depth. The range
corresponds to the radius of the circle. The ability of MCMC to automatically
determine these distributions is one of its primary strengths. </p>

<p>You will
notice that the results panel contains summary information on the position of
the animal including its depth, range and corresponding errors. </p>

<h3>
3.2.1 Localise all Combinations
<NAME="LocaliseallCombinations">
</h3>

<p>Now we are
going to localise all possible combinations of time delays and by doing so we
can check which combination is correct. Localise by pressing <b><i>Localise
All. </i></b>The localiser will now localise all the possible combinations.
Once the localiser has stopped your screen should look something like... </p>
<center>
<p><img width=601 height=376 id="Picture 292"
src="images/image036.jpg"></p>

<p>Figure 22. You can localise all possible time delay
combination for a given detection. The result which has the lowest chi squared
value is also likely the correct combination of detections.</p>
</center>

<p>We now have
multiple clouds, some which have the expected circular shape and others which
do not. Instantly, just by eye, you can see some combinations produce better
results than others. Click on one of the clouds. It will turn red along with
its corresponding time delay combination in the <i>Detection matc</i>h panel.
Clicking on a combination or map symbol will also highlight the corresponding
localisation result in the <i>Results</i> panel. The <i>algorithm display</i>
panel has an MCMC tab. If selected this will show you a graph of chi squared
versus 'jump iteration'. </p>
<center>
<p><img src="images/image037alt.png" alt="The highlighted series here has the lowest average chi squared value and hence is the best fit result. By selecting it in this panel the corresponding cloud in the map and time delay combination in the detection match panel will be highlighted. ">
</center>
<p>The quicker
this graph reaches a low chi squared value the better the time delay
information has fit the algorithm. You can also use this panel to highlight
corresponding detection match lines and plot symbols; it is a handy way of
picking the combination which has the lowest final chi squared value. </p>
<center>
<p><img width=596 height=374 id="Picture 300"
src="images/image040.jpg"></p>

<p>Figure 23. You can select 3D shapes on the map and time
delay possibilities in the detection match panel. </p>
</center>
<p>In the
results panel the result with lowest <b>chi squared value</b> will be ticked.
This result is the best fit to the algorithm which likely indicates it was
calculated from the correct combination of time delays. You can save this
result by pressing <b><i>Save.</i></b></p>

<p>You have now
learned the basics of the MEAL localiser. It is vital you familiarise yourself
with this so take a while to localise other clicks. </p>


<h3>
3.3 Simplex Localisation
<NAME="SimplexLocalisation">
</h3>
<p>The Simplex
algorithm is similar to MCMC however does not show true probability
distributions. It is, however much faster. Select <b><i>Simplex</i></b><i> </i>in
the <i>Algorithm selection </i>panel and compare it to the MCMC algorithm by
localising a few more clicks. Pay attention to the <b><i>millis</i></b> column
in the results table. This shows the computational time of each algorithm. </p>

<center>

<p><img width=601 height=376 id="Picture 303"
src="images/image041.jpg"></p>

<p>Figure 24. Simplex is much faster than MCMC but doesn't
perform quite as well. </p>
</center>

<h3>
3.4 Batch Process Data
<NAME="BatchProcessData">
</h3>
<p>In this section we will batch process
the entire dataset. In doing so we will localise every porpoise click and save
to a database. To save time we will be using the Simplex algorithm, however
analysis with MCMC will produce better results. Make sure Simplex is the only
algorithm selected in the <i>Algorithm selection</i> panel. Select <b><i>Batch
Process</i></b> and tick the <b><i>Batch Localise box </i></b>and ensure<b><i>
All Data </i></b>is selected in the<b><i> Data Options </i></b>drop down menu<b><i>.
</i></b>Next select <b><i>Settings...</i></b></p>
<center>
<p><img src="images/image042alt.png"></p>
</center>
<p>In the <b><i>Batch Process</i></b>
Tab select <b><i>Use a primary hydrophone</i></b> box and set the <b><i>Primary
Hydrophone</i></b> as 4.Using a primary hydrophone means that only clicks on
one channel are processed. This ensures that localisations are not repeated
across different channels. Set the <b><i>Min no. of time delays</i></b> to 4. Min.
number of delays specifies the minimum number of channels which must have a
click detected. Note delays are related to channels by 0.5+sqrt(1+2*TD)/2
were TD is the number of time delays. There is no
point in localising a click which was only detected on one other channel, as
this simply gives you one time delay and hence a hyperbolic cone of infinite
size on which a porpoise may be located i.e. not much localisation information.
</p>

<p>Next select the <b><i>General</i></b>
tab and ensure that <b><i>Display only lowest chi<sup>2</sup> value</i></b>
is selected. This means that only the localisation result with the lowest chi
squared value will be saved from clicks which have multiple possible
combinations. </p>
<center>
<p><img width=200 height=388
id="Picture 309" src="images/image045.png"></p>
</center>
<p>In the <b><i>General</i></b> tab you
can export data to a spread sheet. This is not necessary as data is
automatically saved to a database, however is convenient in many cases to
quickly open data in excel. Tick <b><i>Save to.csv</i></b> and specify a path
using <b><i>Browse</i></b>. Click <b>OK</b>.</p>

<p>Now click <b><i>Start</i></b> and
wait until the data processing is complete. </p>

<h3>
3.5 View results
<NAME="Viewresults">
</h3>
<p>Once the batch processing has
finished open the spread sheet you specified in section 3.4. Using Microsoft
Excel or equivalent select the chi column and filter out any values above 3.
Now selected the z column and plot a graph of results with time. You should end
up with something which looks roughly like.... </p>
<center>
<p><img width=602 height=316 id="Chart 310" src="images/image046.png"></p>

<p>Figure 25. Your results with the Simplex algorithm should
look something like this graph. </p>
</center>
<p>Well done. You have calculated a
porpoise dive profile from raw .wav data. MCMC produces slightly better
result. If you have time you can try and replicate these by batch processing
with MCMC. </p>
<center>
<p><img width=602 height=314 id="Chart 311" src="images/image047.png"></p>

<p>Figure 26. MCMC captures more of the dive. </p>
</center>


<p CLASS="previousLink">
<a href="meal_exercise2_viewData.html">Previous: Exercise2 - View Data </a>
</p>

<p CLASS="nextLink">
<a href="meal_exercise4_geoReferencing3dLocalisations.html">Next: Geo referencing 3D localisations </a>
</p>

</body>